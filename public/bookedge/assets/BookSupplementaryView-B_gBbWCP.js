import{d as A,r as c,l as F,z as T,c as x,w as a,A as G,u as H,a as r,o as B,b as e,g as J,h as y,B as K,C as O}from"./index-B8Co8WN0.js";import{_ as Q}from"./UnsavedChangesDialog.vue_vue_type_script_setup_true_lang-CzR3Qi1m.js";import{u as W}from"./use-validation-rules-CHIpKI1C.js";import{l as U}from"./lodash-xep2xpXO.js";import{u as X}from"./use-books-CWF24FlN.js";const te=A({__name:"BookSupplementaryView",setup(Y){const C=G(),p=H(),{notifyInfo:h,notifyError:j}=O(),{integerRule:b,yearRule:E}=W(),{getBook:R,emptyBook:S,saveBook:D}=X(),f=c(!0),i=c(!1),m=c(!1),v=c(""),o=c(S()),k=c(null),V=c(void 0);F(async()=>{f.value=!0;const d=Number(C.params.bookId);o.value=await R(d),k.value=U.cloneDeep(o.value),f.value=!1,i.value=!1,v.value=""}),T(d=>!i.value&&!U.isEqual(o.value,k.value)?(v.value=d.name,m.value=!0,!1):!0);function I(){m.value=!1,w(),p.push({name:v.value||"books-view"})}function M(){m.value=!1,i.value=!0,K().then(()=>{p.push({name:v.value||"books-view"})})}async function w(){var l;const d=await V.value.validate();d.valid?(await D(o.value),i.value=!0,p.push({name:v.value||"books-view"}),h(`Book ${(l=o.value)==null?void 0:l.title} saved`)):(document.querySelector(`#${d.errors[0].id}`).focus(),j("Check the form for errors and try saving again"))}function $(){i.value=!0,p.push({name:"books-view"})}return(d,l)=>{const z=r("v-progress-linear"),s=r("v-text-field"),u=r("v-col"),n=r("v-row"),_=r("v-textarea"),L=r("v-container"),g=r("v-btn"),N=r("v-form"),P=r("v-card-text"),q=r("v-card");return f.value?(B(),x(z,{key:0,indeterminate:"",color:"primary"})):(B(),x(q,{key:1,title:"Add / Edit Book"},{default:a(()=>[e(P,null,{default:a(()=>[e(N,{ref_key:"form",ref:V,"validate-on":"submit",density:"compact",onSubmit:J(w,["prevent"])},{default:a(()=>[e(L,{fluid:""},{default:a(()=>[e(n,null,{default:a(()=>[e(u,{cols:"3"},{default:a(()=>[e(s,{modelValue:o.value.published_word_count,"onUpdate:modelValue":l[0]||(l[0]=t=>o.value.published_word_count=t),modelModifiers:{number:!0},type:"number",label:"Published word count",rules:[y(b)],density:"compact","data-cy":"published_word_count"},null,8,["modelValue","rules"])]),_:1}),e(u,{cols:"2"},{default:a(()=>[e(s,{modelValue:o.value.image_count,"onUpdate:modelValue":l[1]||(l[1]=t=>o.value.image_count=t),modelModifiers:{number:!0},type:"number",label:"Images in layout",rules:[y(b)],density:"compact","data-cy":"image_count"},null,8,["modelValue","rules"])]),_:1}),e(u,{cols:"7"},{default:a(()=>[e(s,{modelValue:o.value.web_domain,"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.web_domain=t),label:"Book web domain",density:"compact","data-cy":"web_domain"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"6"},{default:a(()=>[e(s,{modelValue:o.value.contains_prior_work,"onUpdate:modelValue":l[3]||(l[3]=t=>o.value.contains_prior_work=t),label:"Previously published material in book",density:"compact","data-cy":"contains_prior_work"},null,8,["modelValue"])]),_:1}),e(u,{cols:"6"},{default:a(()=>[e(s,{modelValue:o.value.contains_others_work,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value.contains_others_work=t),label:"Elements in book not created by author",density:"compact","data-cy":"contains_others_work"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(s,{modelValue:o.value.press_contact,"onUpdate:modelValue":l[5]||(l[5]=t=>o.value.press_contact=t),label:"Press contact",density:"compact","data-cy":"press_contact"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"10"},{default:a(()=>[e(s,{modelValue:o.value.copyright_holder,"onUpdate:modelValue":l[6]||(l[6]=t=>o.value.copyright_holder=t),label:"Copyright holder",density:"compact","data-cy":"copyright_holder"},null,8,["modelValue"])]),_:1}),e(u,{cols:"2"},{default:a(()=>[e(s,{modelValue:o.value.copyright_year,"onUpdate:modelValue":l[7]||(l[7]=t=>o.value.copyright_year=t),type:"number",label:"Copyright year",rules:[y(E)],density:"compact","data-cy":"copyright_year"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(_,{modelValue:o.value.back_cover_text,"onUpdate:modelValue":l[8]||(l[8]=t=>o.value.back_cover_text=t),label:"Back cover text",rows:"1","auto-grow":"",counter:"","persistent-counter":"",density:"compact","data-cy":"back_cover_text"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(_,{modelValue:o.value.jacket_front_text,"onUpdate:modelValue":l[9]||(l[9]=t=>o.value.jacket_front_text=t),label:"Book jacket front text",rows:"1","auto-grow":"",counter:"","persistent-counter":"",density:"compact","data-cy":"jacket_front_text"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(_,{modelValue:o.value.jacket_back_text,"onUpdate:modelValue":l[10]||(l[10]=t=>o.value.jacket_back_text=t),label:"Book jacket rear text",rows:"1","auto-grow":"",counter:"","persistent-counter":"",density:"compact","data-cy":"jacket_back_text"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(_,{modelValue:o.value.legal_notice,"onUpdate:modelValue":l[11]||(l[11]=t=>o.value.legal_notice=t),label:"Legal notice",rows:"1","auto-grow":"",counter:"","persistent-counter":"",density:"compact","data-cy":"legal_notice"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(s,{modelValue:o.value.featured_ads,"onUpdate:modelValue":l[12]||(l[12]=t=>o.value.featured_ads=t),label:"Featured ads",density:"compact","data-cy":"featured_ads"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(_,{modelValue:o.value.errata,"onUpdate:modelValue":l[13]||(l[13]=t=>o.value.errata=t),label:"Errata",rows:"2","auto-grow":"",counter:"",density:"compact","data-cy":"errata"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(n,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(g,{type:"submit",text:"Save",color:"primary",size:"small","data-cy":"save-book"}),e(g,{class:"ml-4",text:"Cancel",size:"small","data-cy":"cancel-book",onClick:$})]),_:1})]),_:1})]),_:1},512),e(Q,{show:m.value,"item-name":"book",onSave:I,onDontSave:M,onCancelled:l[14]||(l[14]=t=>m.value=!1)},null,8,["show"])]),_:1})]),_:1}))}}});export{te as default};
