import{d as J,r,m as R,l as K,z as Q,c as S,w as t,A as W,u as X,O as Y,a as n,o as I,b as e,g as Z,h as y,B as ee,C as ae}from"./index-BmIoG3EC.js";import{_ as le}from"./UnsavedChangesDialog.vue_vue_type_script_setup_true_lang-C1uZsk7D.js";import{u as te}from"./use-validation-rules-YCz6tJiF.js";import{l as E}from"./lodash-CMk6ASS6.js";import{u as se}from"./use-imprints-hmX-DmGB.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne=J({__name:"UserView",setup(ue){const w=W(),c=X(),{notifyInfo:h,notifyError:B}=ae(),{requiredRule:V,emailRule:D}=te(),{getUser:N,emptyUser:U,saveUser:$}=Y(),{imprints:q,findImprints:z}=se(),b=r(void 0),p=r(!0),i=r(!1),d=r(""),m=r(!1),a=r(U()),x=r(null),A=["admin","productManager","editor","layoutDesigner","proofer","publisher","author"],g=R(()=>a.value.created_at?a.value.created_at.slice(0,10):""),L=R(()=>q.value.map(o=>({value:o.id,title:o.imprint_name})));K(async()=>{if(p.value=!0,w.params.userId==="new")a.value=U();else{const o=Number(w.params.userId);a.value=await N(o)}x.value=E.cloneDeep(a.value),await z({}),p.value=!1,i.value=!1,d.value=""}),Q(o=>!i.value&&!E.isEqual(a.value,x.value)?(d.value=o.name,m.value=!0,!1):!0);function M(){m.value=!1,C(),c.push({name:d.value||"users-view"})}function O(){m.value=!1,i.value=!0,ee().then(()=>{c.push({name:d.value||"users-view"})})}async function C(){var l;const o=await b.value.validate();o.valid?(await $(a.value),i.value=!0,c.push({name:d.value||"users-view"}),h(`User ${(l=a.value)==null?void 0:l.email} saved`)):(document.querySelector(`#${o.errors[0].id}`).focus(),B("Check the form for errors and try saving again"))}function P(){i.value=!0,c.push({name:"users-view"})}return(o,l)=>{const T=n("v-progress-linear"),v=n("v-text-field"),u=n("v-col"),f=n("v-row"),_=n("v-select"),j=n("v-container"),k=n("v-btn"),F=n("v-form"),G=n("v-card-text"),H=n("v-card");return p.value?(I(),S(T,{key:0,indeterminate:"",color:"primary"})):(I(),S(H,{key:1,title:"Add / Edit User"},{default:t(()=>[e(G,null,{default:t(()=>[e(F,{ref_key:"form",ref:b,"validate-on":"submit",density:"compact",onSubmit:Z(C,["prevent"])},{default:t(()=>[e(j,{fluid:""},{default:t(()=>[e(f,null,{default:t(()=>[e(u,{cols:"4"},{default:t(()=>[e(v,{modelValue:a.value.email,"onUpdate:modelValue":l[0]||(l[0]=s=>a.value.email=s),label:"Email",rules:[y(V),y(D)],density:"compact",clearable:"","data-cy":"email"},null,8,["modelValue","rules"])]),_:1}),e(u,{cols:"4"},{default:t(()=>[e(v,{modelValue:a.value.name,"onUpdate:modelValue":l[1]||(l[1]=s=>a.value.name=s),label:"Name",rules:[y(V)],density:"compact",clearable:"","data-cy":"name"},null,8,["modelValue","rules"])]),_:1}),e(u,{cols:"4"},{default:t(()=>[e(v,{modelValue:a.value.password,"onUpdate:modelValue":l[2]||(l[2]=s=>a.value.password=s),label:"Password",density:"compact","data-cy":"password"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,null,{default:t(()=>[e(u,{cols:"2"},{default:t(()=>[e(_,{modelValue:a.value.status,"onUpdate:modelValue":l[3]||(l[3]=s=>a.value.status=s),label:"Status",items:["active","archived"],density:"compact","data-cy":"status"},null,8,["modelValue"])]),_:1}),e(u,{cols:"4"},{default:t(()=>[e(_,{modelValue:a.value.roles,"onUpdate:modelValue":l[4]||(l[4]=s=>a.value.roles=s),label:"User Roles",items:A,multiple:"",density:"compact","data-cy":"user-roles"},null,8,["modelValue"])]),_:1}),e(u,{cols:"4"},{default:t(()=>[e(_,{modelValue:a.value.allowed_imprints,"onUpdate:modelValue":l[5]||(l[5]=s=>a.value.allowed_imprints=s),label:"Allowed Imprints",items:L.value,multiple:"",density:"compact","data-cy":"allowed-imprints"},null,8,["modelValue","items"])]),_:1}),e(u,{cols:"2"},{default:t(()=>[e(v,{modelValue:g.value,"onUpdate:modelValue":l[6]||(l[6]=s=>g.value=s),label:"User since",density:"compact",readonly:"","data-cy":"created-at"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,null,{default:t(()=>[e(u,{cols:"12"},{default:t(()=>[e(k,{text:"Save",type:"submit",color:"primary",size:"small","data-cy":"save-user"}),e(k,{class:"ml-4",text:"Cancel",size:"small","data-cy":"cancel-user",onClick:P})]),_:1})]),_:1}),e(le,{show:m.value,"item-name":"user",onSave:M,onDontSave:O,onCancelled:l[7]||(l[7]=s=>m.value=!1)},null,8,["show"])]),_:1},512)]),_:1})]),_:1}))}}}),pe=oe(ne,[["__scopeId","data-v-b4e9db56"]]);export{pe as default};
