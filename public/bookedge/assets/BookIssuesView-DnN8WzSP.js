import{u as K}from"./use-issues-CbRQxEvu.js";import{d as O,r,k as _,l as Q,m as X,c as b,w as o,A as Y,u as Z,a as t,o as I,b as s,n as ee,h as p,p as x,i as C,t as se,e as oe,j as te}from"./index-BmIoG3EC.js";import{_ as ae}from"./ConfirmationDialog.vue_vue_type_script_setup_true_lang-C-3IeOeY.js";const ne=oe("span",{class:"text-h6"},"Issues",-1),ue=O({__name:"BookIssuesView",setup(le){const{issues:f,findIssues:P,removeIssue:V,toggleResolved:S}=K(),{currentUser:y}=te(),R=Y(),A=Z(),c=r(!1),u=r(""),l=_("issuesShowResolved",!1),g=_("issuesItemsPerPage",10),d=_("issuesSort",[{key:"issue_name",order:"asc"}]),i=r(!1),k=r({}),B=[{title:"Date",key:"date",minWidth:"12em"},{title:"Issue",key:"issue"},{title:"Entered by",key:"entered_by"},{title:"Resolved",key:"resolved"},{title:"Actions",key:"actions",minWidth:"8em",sortable:!1}];Q(async()=>{c.value=!0,await P({fk_book:Number(R.params.bookId)}),c.value=!1});const U=X(()=>l.value?f.value:f.value.filter(a=>a.resolved!==!0)),$=a=>{g.value=a},N=a=>{A.push({name:"issue-view",params:{issueId:a.toString()}})},D=a=>{k.value=a,i.value=!0},T=async()=>{i.value=!1,await V(k.value.id)},W=async a=>{var n;((n=y.value.roles)!=null&&n.includes("admin")||y.value.name===a.entered_by)&&await S(a.id)};return(a,n)=>{const j=t("v-progress-circular"),z=t("v-btn"),w=t("router-link"),E=t("v-tooltip"),m=t("v-col"),F=t("v-switch"),L=t("v-text-field"),M=t("v-row"),q=t("v-card-title"),v=t("v-icon"),G=t("v-data-table"),H=t("v-card-text"),J=t("v-card");return c.value?(I(),b(j,{key:0,indeterminate:"",color:"primary"})):(I(),b(J,{key:1},{default:o(()=>[s(q,null,{default:o(()=>[s(M,{class:"mt-1"},{default:o(()=>[s(m,{cols:"4"},{default:o(()=>[ne,s(E,{text:"Add an issue"},{activator:o(({props:e})=>[s(w,{to:{name:"issue-view",params:{issueId:"new"}}},{default:o(()=>[s(z,ee({class:"ml-4"},e,{color:"info",icon:"mdi-plus",size:"x-small","data-cy":"add-item"}),null,16)]),_:2},1024)]),_:1})]),_:1}),s(m,{cols:"2",align:"right"},{default:o(()=>[s(F,{modelValue:p(l),"onUpdate:modelValue":n[0]||(n[0]=e=>x(l)?l.value=e:null),label:"Show resolved issues",color:"primary","data-cy":"show-resolved"},null,8,["modelValue"])]),_:1}),s(m,{cols:"6",align:"right"},{default:o(()=>[s(L,{modelValue:u.value,"onUpdate:modelValue":n[1]||(n[1]=e=>u.value=e),"append-inner-icon":"mdi-magnify",label:"Search",density:"compact",clearable:"","single-line":"","data-cy":"search"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(H,null,{default:o(()=>[s(G,{class:"elevation-1","sort-by":p(d),"onUpdate:sortBy":n[2]||(n[2]=e=>x(d)?d.value=e:null),headers:B,items:U.value,"items-per-page":p(g),search:u.value,density:"compact","data-cy":"issues-table","onUpdate:itemsPerPage":$},{"item.date":o(({item:e})=>[s(w,{to:{name:"issue-view",params:{issueId:e.id}}},{default:o(()=>[C(se(e.date),1)]),_:2},1032,["to"])]),"item.resolved":o(({item:e})=>[s(v,{color:e.resolved?"green":"red",onClick:h=>W(e)},{default:o(()=>[C("mdi-checkbox-marked-circle")]),_:2},1032,["color","onClick"])]),"item.actions":o(({item:e})=>[s(v,{icon:"mdi-pencil",color:"primary",onClick:h=>N(e.id)},null,8,["onClick"]),s(v,{class:"ml-2",icon:"mdi-minus-circle",color:"grey","data-cy":"remove-issue",onClick:h=>D(e)},null,8,["onClick"])]),_:1},8,["sort-by","items","items-per-page","search"])]),_:1}),s(ae,{show:i.value,text:"Are you sure you want to remove this issue?",onConfirmed:T,onCancelled:n[3]||(n[3]=e=>i.value=!1)},null,8,["show"])]),_:1}))}}});export{ue as default};
