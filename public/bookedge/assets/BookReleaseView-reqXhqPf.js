import{d as Q,A as h,u as H,r as m,k as K,l as J,m as ee,a as s,o as V,c as C,w as o,b as e,n as le,h as L,p as ae,i as te,t as oe,e as ne,z as se,g as ue,D as W,F as j,E as de,B as ie,C as re}from"./index-BmIoG3EC.js";import{_ as me}from"./UnsavedChangesDialog.vue_vue_type_script_setup_true_lang-C1uZsk7D.js";import{u as ce}from"./use-validation-rules-YCz6tJiF.js";import{l as G}from"./lodash-CMk6ASS6.js";import{u as pe}from"./use-releases-C-sL2egd.js";import{u as ve}from"./use-pricings-Cig2YM4k.js";import{_ as _e}from"./ConfirmationDialog.vue_vue_type_script_setup_true_lang-C-3IeOeY.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye=ne("span",{class:"text-h6"},"Pricings",-1),ge=Q({__name:"ReleasePricings",setup(O){const{pricings:x,findPricings:k,removePricing:D}=ve(),B=h(),z=H(),S=m(!1),w=m(""),R=K("pricingsItemsPerPage",10),U=K("pricingsSort",[{key:"pricing_name",order:"asc"}]),c=m(!1),p=m({}),g=[{title:"Start date",key:"start_date"},{title:"US SRP",key:"us_srp"},{title:"US discount",key:"us_discount"},{title:"US returns",key:"us_returnable"},{title:"Actions",key:"actions",sortable:!1}];J(async()=>{S.value=!0,await k({fk_release:Number(B.params.releaseId)}),S.value=!1});const b=ee(()=>x.value),l=v=>{R.value=v},I=v=>{z.push({name:"pricing-view",params:{pricingId:v.toString()}})},A=v=>{p.value=v,c.value=!0},N=async()=>{c.value=!1,await D(p.value.id)};return(v,_)=>{const $=s("v-progress-circular"),E=s("v-btn"),P=s("router-link"),M=s("v-tooltip"),r=s("v-col"),a=s("v-text-field"),T=s("v-row"),f=s("v-card-title"),n=s("v-card-text"),y=s("v-icon"),u=s("v-data-table"),d=s("v-card");return S.value?(V(),C($,{key:0,indeterminate:"",color:"primary"})):(V(),C(d,{key:1},{default:o(()=>[e(f,null,{default:o(()=>[e(T,{class:"mt-1"},{default:o(()=>[e(r,{cols:"4"},{default:o(()=>[ye,e(M,{text:"Add a pricing"},{activator:o(({props:i})=>[e(P,{to:{name:"pricing-view",params:{pricingId:"new"}}},{default:o(()=>[e(E,le({class:"ml-4"},i,{color:"info",icon:"mdi-plus",size:"x-small","data-cy":"add-pricing"}),null,16)]),_:2},1024)]),_:1})]),_:1}),e(r,{cols:"2",align:"right"}),e(r,{cols:"6",align:"right"},{default:o(()=>[e(a,{modelValue:w.value,"onUpdate:modelValue":_[0]||(_[0]=i=>w.value=i),"append-inner-icon":"mdi-magnify",label:"Search",density:"compact",clearable:"","single-line":"","data-cy":"search"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(n),e(n,null,{default:o(()=>[e(u,{class:"elevation-1","sort-by":L(U),"onUpdate:sortBy":_[1]||(_[1]=i=>ae(U)?U.value=i:null),headers:g,items:b.value,"items-per-page":L(R),search:w.value,density:"compact","data-cy":"pricings-table","onUpdate:itemsPerPage":l},{"item.start_date":o(({item:i})=>[e(P,{to:{name:"pricing-view",params:{pricingId:i.id}}},{default:o(()=>[te(oe(i.start_date),1)]),_:2},1032,["to"])]),"item.actions":o(({item:i})=>[e(y,{icon:"mdi-pencil",color:"primary","data-cy":"edit-pricing",onClick:q=>I(i.id)},null,8,["onClick"]),e(y,{class:"ml-2",icon:"mdi-minus-circle",color:"grey","data-cy":"remove-pricing",onClick:q=>A(i)},null,8,["onClick"])]),_:1},8,["sort-by","items","items-per-page","search"])]),_:1}),e(_e,{show:c.value,text:"Are you sure you want to remove this pricing?",onConfirmed:N,onCancelled:_[2]||(_[2]=i=>c.value=!1)},null,8,["show"])]),_:1}))}}}),be=Q({__name:"BookReleaseView",setup(O){const x=h(),k=H(),{notifyInfo:D,notifyError:B}=re(),{requiredRule:z}=ce(),{getRelease:S,emptyRelease:w,saveRelease:R}=pe(),U=m(void 0),c=m(!0),p=m(!1),g=m(""),b=m(!1),l=m(w()),I=m(null),A=["print-LSI","kindle","epub","pdf","apple","nook","kobo","google"],N=["perfect bound","case laminate","jacketed case laminate","digital cloth blue","digital cloth gray"],v=["creme","white","50 white","70 white","premium color","ultra premium color"],_=["7.44 x 9.69","5.5 x 8.5","6 x 9","8 x 10","5 x 8","7 x 10","11 x 8.5"];J(async()=>{if(c.value=!0,x.params.releaseId==="new")l.value=w(),l.value.fk_book=Number(x.params.bookId);else{const r=Number(x.params.releaseId);l.value=await S(r)}I.value=G.cloneDeep(l.value),c.value=!1,p.value=!1,g.value=""}),se(r=>!p.value&&!G.isEqual(l.value,I.value)?(g.value=r.name,b.value=!0,!1):!0);function $(){b.value=!1,P(),k.push({name:g.value||"releases-view"})}function E(){b.value=!1,p.value=!0,ie().then(()=>{k.push({name:g.value||"releases-view"})})}async function P(){var a;const r=await U.value.validate();r.valid?(await R(l.value),p.value=!0,k.push({name:g.value||"releases-view"}),D(`Release ${(a=l.value)==null?void 0:a.release_type} saved`)):(document.querySelector(`#${r.errors[0].id}`).focus(),B("Check the form for errors and try saving again"))}function M(){p.value=!0,k.push({name:"releases-view"})}return(r,a)=>{const T=s("v-progress-linear"),f=s("v-select"),n=s("v-col"),y=s("v-switch"),u=s("v-text-field"),d=s("v-row"),i=s("v-combobox"),q=s("v-textarea"),F=s("v-btn"),X=s("v-form"),Y=s("v-card-text"),Z=s("v-card");return c.value?(V(),C(T,{key:0,indeterminate:"",color:"primary"})):(V(),C(Z,{key:1,title:"Add / Edit Release"},{default:o(()=>[e(Y,null,{default:o(()=>[e(X,{ref_key:"form",ref:U,"validate-on":"submit",density:"compact",onSubmit:ue(P,["prevent"])},{default:o(()=>[e(d,null,{default:o(()=>[e(n,{cols:"2"},{default:o(()=>[e(f,{modelValue:l.value.release_type,"onUpdate:modelValue":a[0]||(a[0]=t=>l.value.release_type=t),label:"Release type",items:A,rules:[L(z)],density:"compact","data-cy":"release-type"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"2"},{default:o(()=>[e(y,{modelValue:l.value.full_distribution,"onUpdate:modelValue":a[1]||(a[1]=t=>l.value.full_distribution=t),label:"Full Distribution",color:"primary",density:"compact","data-cy":"full-distribution"},null,8,["modelValue"])]),_:1}),e(n,{cols:"2"},{default:o(()=>[e(y,{modelValue:l.value.preorder,"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.preorder=t),label:"Preorder",color:"primary",density:"compact","data-cy":"preorder"},null,8,["modelValue"])]),_:1}),e(n,{cols:"2"},{default:o(()=>[e(u,{modelValue:l.value.sku,"onUpdate:modelValue":a[3]||(a[3]=t=>l.value.sku=t),label:"SKU",hint:"optional",density:"compact","data-cy":"sku"},null,8,["modelValue"])]),_:1}),e(n,{cols:"2"},{default:o(()=>[e(f,{modelValue:l.value.status,"onUpdate:modelValue":a[4]||(a[4]=t=>l.value.status=t),label:"Status",items:["active","archived"],density:"compact","data-cy":"imprint-status"},null,8,["modelValue"])]),_:1})]),_:1}),l.value.release_type==="print-LSI"?(V(),W(j,{key:0},[e(d,null,{default:o(()=>[e(n,{cols:"2"},{default:o(()=>[e(i,{modelValue:l.value.trim_size,"onUpdate:modelValue":a[5]||(a[5]=t=>l.value.trim_size=t),label:"Trim Size (in inches)",items:_,density:"compact","data-cy":"trim-size"},null,8,["modelValue"])]),_:1}),e(n,{cols:"2"},{default:o(()=>[e(f,{modelValue:l.value.color,"onUpdate:modelValue":a[6]||(a[6]=t=>l.value.color=t),label:"Interior color",items:["black & white","color"],density:"compact","data-cy":"interior-color"},null,8,["modelValue"])]),_:1}),e(n,{cols:"2"},{default:o(()=>[e(f,{modelValue:l.value.paper,"onUpdate:modelValue":a[7]||(a[7]=t=>l.value.paper=t),label:"Paper",items:v,density:"compact","data-cy":"paper-color"},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:o(()=>[e(f,{modelValue:l.value.binding,"onUpdate:modelValue":a[8]||(a[8]=t=>l.value.binding=t),label:"Binding",items:N,density:"compact","data-cy":"binding"},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:o(()=>[e(f,{modelValue:l.value.cover_finish,"onUpdate:modelValue":a[9]||(a[9]=t=>l.value.cover_finish=t),label:"Cover Finish",items:["glossy","matte"],density:"compact","data-cy":"paper-color"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(n,{cols:"3"},{default:o(()=>[e(u,{modelValue:l.value.page_count,"onUpdate:modelValue":a[10]||(a[10]=t=>l.value.page_count=t),modelModifiers:{number:!0},type:"number",label:"Page Count",density:"compact","data-cy":"page-count"},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:o(()=>[e(u,{modelValue:l.value.spine_width,"onUpdate:modelValue":a[11]||(a[11]=t=>l.value.spine_width=t),modelModifiers:{number:!0},type:"number",label:"Spine Width",density:"compact","data-cy":"spine-width"},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:o(()=>[e(u,{modelValue:l.value.weight,"onUpdate:modelValue":a[12]||(a[12]=t=>l.value.weight=t),modelModifiers:{number:!0},label:"Weight",type:"number",density:"compact","data-cy":"weight"},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:o(()=>[e(u,{modelValue:l.value.carton_quantity,"onUpdate:modelValue":a[13]||(a[13]=t=>l.value.carton_quantity=t),modelModifiers:{number:!0},label:"Carton Quantity",type:"number",density:"compact","data-cy":"carton-quantity"},null,8,["modelValue"])]),_:1})]),_:1})],64)):(V(),C(d,{key:1},{default:o(()=>[e(n,{cols:"3"},{default:o(()=>[e(u,{modelValue:l.value.asin,"onUpdate:modelValue":a[14]||(a[14]=t=>l.value.asin=t),label:"ASIN",density:"compact","data-cy":"asin"},null,8,["modelValue"])]),_:1}),e(n,{cols:"2"},{default:o(()=>[e(y,{modelValue:l.value.drm,"onUpdate:modelValue":a[15]||(a[15]=t=>l.value.drm=t),label:"DRM",color:"primary",density:"compact","data-cy":"drm"},null,8,["modelValue"])]),_:1}),l.value.release_type==="kindle"?(V(),W(j,{key:0},[e(n,{cols:"2"},{default:o(()=>[e(y,{modelValue:l.value.kdp_select,"onUpdate:modelValue":a[16]||(a[16]=t=>l.value.kdp_select=t),label:"KDP Select",color:"primary",density:"compact","data-cy":"kdp-select"},null,8,["modelValue"])]),_:1}),e(n,{cols:"2"},{default:o(()=>[e(y,{modelValue:l.value.kdp_match_book,"onUpdate:modelValue":a[17]||(a[17]=t=>l.value.kdp_match_book=t),label:"KDP Match Book",color:"primary",density:"compact","data-cy":"kdp-match-book"},null,8,["modelValue"])]),_:1})],64)):de("",!0)]),_:1})),e(d,null,{default:o(()=>[e(n,{cols:"3"},{default:o(()=>[e(u,{modelValue:l.value.submission_date,"onUpdate:modelValue":a[18]||(a[18]=t=>l.value.submission_date=t),label:"Submission Date",density:"compact","data-cy":"submission-date"},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:o(()=>[e(u,{modelValue:l.value.acceptance_date,"onUpdate:modelValue":a[19]||(a[19]=t=>l.value.acceptance_date=t),label:"Acceptance Date",density:"compact","data-cy":"acceptance-date"},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:o(()=>[e(u,{modelValue:l.value.pre_order_date,"onUpdate:modelValue":a[20]||(a[20]=t=>l.value.pre_order_date=t),label:"Pre-order Date",density:"compact","data-cy":"on-sale-date"},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:o(()=>[e(u,{modelValue:l.value.publication_date,"onUpdate:modelValue":a[21]||(a[21]=t=>l.value.publication_date=t),label:"Publication Date",density:"compact","data-cy":"publish-date"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(n,{cols:"12"},{default:o(()=>[e(ge)]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(n,{cols:"12"},{default:o(()=>[e(u,{modelValue:l.value.amazon_sales_page,"onUpdate:modelValue":a[22]||(a[22]=t=>l.value.amazon_sales_page=t),label:"Amazon Sales Page",density:"compact","data-cy":"amazon-sales-page"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(n,{cols:"12"},{default:o(()=>[e(u,{modelValue:l.value.bn_sales_page,"onUpdate:modelValue":a[23]||(a[23]=t=>l.value.bn_sales_page=t),label:"Barnes & Noble Sales Page",density:"compact","data-cy":"bn-sales-page"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(n,{cols:"12"},{default:o(()=>[e(u,{modelValue:l.value.apple_sales_page,"onUpdate:modelValue":a[24]||(a[24]=t=>l.value.apple_sales_page=t),label:"Apple Sales Page",density:"compact","data-cy":"apple-sales-page"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(n,{cols:"12"},{default:o(()=>[e(u,{modelValue:l.value.kobo_sales_page,"onUpdate:modelValue":a[25]||(a[25]=t=>l.value.kobo_sales_page=t),label:"Kobo Sales Page",density:"compact","data-cy":"kobo-sales-page"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(n,{cols:"12"},{default:o(()=>[e(u,{modelValue:l.value.google_sales_page,"onUpdate:modelValue":a[26]||(a[26]=t=>l.value.google_sales_page=t),label:"Google Sales Page",density:"compact","data-cy":"google-sales-page"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(n,{cols:"12"},{default:o(()=>[e(q,{modelValue:l.value.notes,"onUpdate:modelValue":a[27]||(a[27]=t=>l.value.notes=t),label:"Notes",rows:"2","auto-grow":"",counter:"",density:"compact","data-cy":"notes"},null,8,["modelValue"])]),_:1})]),_:1}),e(F,{type:"submit",text:"Save",color:"primary",size:"small","data-cy":"save-release"}),e(F,{class:"ml-4",text:"Cancel",size:"small","data-cy":"cancel-release",onClick:M})]),_:1},512),e(me,{show:b.value,"item-name":"release",onSave:$,onDontSave:E,onCancelled:a[28]||(a[28]=t=>b.value=!1)},null,8,["show"])]),_:1})]),_:1}))}}}),Re=fe(be,[["__scopeId","data-v-6f5d7c48"]]);export{Re as default};
