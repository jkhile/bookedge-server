import{d as L,r as m,l as T,z as j,c as M,w as t,A as F,u as H,a as d,o as C,b as e,f as J,g as n,B as O,C as Q}from"./index-DZhxj18n.js";import{_ as W}from"./UnsavedChangesDialog.vue_vue_type_script_setup_true_lang-D3NdNa9i.js";import{u as X}from"./use-validation-rules-CMFBqc6K.js";import{l as P}from"./lodash-Bvz3dTqJ.js";import{u as Z}from"./use-pricings-DtVdA6C9.js";import{_ as h}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee=L({__name:"ReleasePricingView",setup(le){const y=F(),b=H(),{notifyInfo:S,notifyError:x}=Q(),{requiredRule:V,currencyRule:c,dateYMDRule:Y}=X(),{getPricing:N,emptyPricing:U,savePricing:I}=Z(),k=m(void 0),g=m(!0),f=m(!1),v=m(""),_=m(!1),l=m(U()),R=m(null);T(async()=>{if(g.value=!0,y.params.pricingId==="new")l.value=U(),l.value.fk_release=Number(y.params.releaseId);else{const s=Number(y.params.pricingId);l.value=await N(s)}R.value=P.cloneDeep(l.value),g.value=!1,f.value=!1,v.value=""}),j(s=>!f.value&&!P.isEqual(l.value,R.value)?(v.value=s.name,_.value=!0,!1):!0);const E=s=>/^\d+$/.test(s)&&Number(s)>=25&&Number(s)<=100||"Invalid input. Must be an integer between 25 and 100 inclusive.";function A(){_.value=!1,D(),b.push({name:v.value||"release-view",params:{releaseId:l.value.fk_release}})}function B(){_.value=!1,f.value=!0,O().then(()=>{b.push({name:v.value||"release-view",params:{releaseId:l.value.fk_release}})})}async function D(){var a;const s=await k.value.validate();s.valid?(await I(l.value),f.value=!0,b.push({name:v.value||"release-view",params:{releaseId:l.value.fk_release}}),S(`Pricing ${(a=l.value)==null?void 0:a.start_date} saved`)):(document.querySelector(`#${s.errors[0].id}`).focus(),x("Check the form for errors and try saving again"))}function $(){f.value=!0,b.push({name:v.value||"release-view",params:{releaseId:l.value.fk_release}})}return(s,a)=>{const q=d("v-progress-linear"),r=d("v-text-field"),o=d("v-col"),i=d("v-row"),p=d("v-select"),w=d("v-btn"),z=d("v-form"),G=d("v-card-text"),K=d("v-card");return g.value?(C(),M(q,{key:0,indeterminate:"",color:"primary"})):(C(),M(K,{key:1,title:"Add / Edit Pricing"},{default:t(()=>[e(G,null,{default:t(()=>[e(z,{ref_key:"form",ref:k,"validate-on":"submit",density:"compact",onSubmit:J(D,["prevent"])},{default:t(()=>[e(i,null,{default:t(()=>[e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.start_date,"onUpdate:modelValue":a[0]||(a[0]=u=>l.value.start_date=u),label:"Pricing effective as of (yyyy-MM-dd)",rules:[n(V),n(Y)],density:"compact","data-cy":"start-date"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.us_srp,"onUpdate:modelValue":a[1]||(a[1]=u=>l.value.us_srp=u),modelModifiers:{number:!0},label:"US SRP",rules:[n(V),n(c)],density:"compact","data-cy":"us-srp"},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.us_discount,"onUpdate:modelValue":a[2]||(a[2]=u=>l.value.us_discount=u),modelModifiers:{number:!0},label:"US Discount (percent)",rules:[n(V),E],required:"",density:"compact","data-cy":"us-discount"},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(p,{modelValue:l.value.us_returnable,"onUpdate:modelValue":a[3]||(a[3]=u=>l.value.us_returnable=u),label:"US Returnable",required:"",density:"compact",items:["No","Yes - Deliver","Yes - Destroy"],"data-cy":"us-returnable"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.uk_srp,"onUpdate:modelValue":a[4]||(a[4]=u=>l.value.uk_srp=u),modelModifiers:{number:!0},label:"UK SRP",rules:[n(c)],required:"",density:"compact","data-cy":"uk-srp"},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.uk_discount,"onUpdate:modelValue":a[5]||(a[5]=u=>l.value.uk_discount=u),modelModifiers:{number:!0},label:"UK Discount (percent)",required:"",density:"compact","data-cy":"uk-discount"},null,8,["modelValue"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(p,{modelValue:l.value.uk_returnable,"onUpdate:modelValue":a[6]||(a[6]=u=>l.value.uk_returnable=u),label:"UK Returnable",required:"",density:"compact",items:["No","Yes - Deliver","Yes - Destroy"],"data-cy":"uk-returnable"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.eu_srp,"onUpdate:modelValue":a[7]||(a[7]=u=>l.value.eu_srp=u),modelModifiers:{number:!0},label:"EU SRP",rules:[n(c)],required:"",density:"compact","data-cy":"eu-srp"},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.eu_discount,"onUpdate:modelValue":a[8]||(a[8]=u=>l.value.eu_discount=u),modelModifiers:{number:!0},label:"EU Discount (percent)",required:"",density:"compact","data-cy":"eu-discount"},null,8,["modelValue"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(p,{modelValue:l.value.eu_returnable,"onUpdate:modelValue":a[9]||(a[9]=u=>l.value.eu_returnable=u),label:"EU Returnable",required:"",density:"compact",items:["No","Yes - Deliver","Yes - Destroy"],"data-cy":"eu-returnable"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.ca_srp,"onUpdate:modelValue":a[10]||(a[10]=u=>l.value.ca_srp=u),modelModifiers:{number:!0},label:"CA SRP",rules:[n(c)],required:"",density:"compact","data-cy":"ca-srp"},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.ca_discount,"onUpdate:modelValue":a[11]||(a[11]=u=>l.value.ca_discount=u),modelModifiers:{number:!0},label:"CA Discount (percent)",required:"",density:"compact","data-cy":"ca-discount"},null,8,["modelValue"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(p,{modelValue:l.value.ca_returnable,"onUpdate:modelValue":a[12]||(a[12]=u=>l.value.ca_returnable=u),label:"CA Returnable",required:"",density:"compact",items:["No","Yes - Deliver","Yes - Destroy"],"data-cy":"ca-returnable"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.au_srp,"onUpdate:modelValue":a[13]||(a[13]=u=>l.value.au_srp=u),modelModifiers:{number:!0},label:"AU SRP",rules:[n(c)],required:"",density:"compact","data-cy":"au-srp"},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.au_discount,"onUpdate:modelValue":a[14]||(a[14]=u=>l.value.au_discount=u),modelModifiers:{number:!0},label:"AU Discount (percent)",required:"",density:"compact","data-cy":"au-discount"},null,8,["modelValue"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(p,{modelValue:l.value.au_returnable,"onUpdate:modelValue":a[15]||(a[15]=u=>l.value.au_returnable=u),label:"AU Returnable",required:"",density:"compact",items:["No","Yes - Deliver","Yes - Destroy"],"data-cy":"au-returnable"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.gc_srp,"onUpdate:modelValue":a[16]||(a[16]=u=>l.value.gc_srp=u),modelModifiers:{number:!0},label:"Global Connect SRP",rules:[n(c)],required:"",density:"compact","data-cy":"gc-srp"},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(r,{modelValue:l.value.gc_discount,"onUpdate:modelValue":a[17]||(a[17]=u=>l.value.gc_discount=u),modelModifiers:{number:!0},label:"Global Connect Discount (percent)",required:"",density:"compact","data-cy":"gc-discount"},null,8,["modelValue"])]),_:1}),e(o,{cols:"2"},{default:t(()=>[e(p,{modelValue:l.value.gc_returnable,"onUpdate:modelValue":a[18]||(a[18]=u=>l.value.gc_returnable=u),label:"Global Connect Returnable",required:"",density:"compact",items:["No","Yes - Deliver","Yes - Destroy"],"data-cy":"gc-returnable"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(o,{cols:"12"}),e(w,{type:"submit",text:"Save",color:"primary",size:"small","data-cy":"save-pricing"}),e(w,{class:"ml-4",text:"Cancel",size:"small","data-cy":"cancel-pricing",onClick:$})]),_:1})]),_:1},512),e(W,{show:_.value,"item-name":"pricing",onSave:A,onDontSave:B,onCancelled:a[19]||(a[19]=u=>_.value=!1)},null,8,["show"])]),_:1})]),_:1}))}}}),ne=h(ee,[["__scopeId","data-v-414e98da"]]);export{ne as default};
