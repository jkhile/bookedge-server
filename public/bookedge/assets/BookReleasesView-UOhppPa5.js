import{u as G}from"./use-releases-wNU0eILh.js";import{d as H,r as c,k as _,l as J,m as K,c as w,w as s,A as O,u as Q,a as t,o as k,b as e,n as W,h as v,p as b,i as X,t as Y,e as Z}from"./index-WMoJuzLy.js";import{_ as ee}from"./ConfirmationDialog.vue_vue_type_script_setup_true_lang-BQbeUpJH.js";const ae=Z("span",{class:"text-h6"},"Releases",-1),ne=H({__name:"BookReleasesView",setup(te){const{releases:p,findReleases:x,archiveRelease:R}=G(),C=O(),P=Q(),i=c(!1),n=_("releasesShowArchived",!1),u=c(""),f=_("releasesItemsPerPage",10),d=_("releasesSort",[{key:"release_type",order:"asc"}]),r=c(!1),y=c({}),V=[{title:"Release type",key:"release_type"},{title:"Binding",key:"binding"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}];J(async()=>{i.value=!0,await x({fk_book:Number(C.params.bookId)}),i.value=!1});const S=K(()=>n.value?p.value:p.value.filter(o=>o.status!=="archived")),A=o=>{f.value=o},B=o=>{P.push({name:"release-view",params:{releaseId:o.toString()}})},I=o=>{y.value=o,r.value=!0},N=async()=>{r.value=!1,await R(y.value.id)};return(o,l)=>{const U=t("v-progress-circular"),$=t("v-btn"),h=t("router-link"),D=t("v-tooltip"),m=t("v-col"),T=t("v-switch"),z=t("v-text-field"),L=t("v-row"),M=t("v-card-title"),g=t("v-icon"),j=t("v-data-table"),q=t("v-card-text"),E=t("v-card");return i.value?(k(),w(U,{key:0,indeterminate:"",color:"primary"})):(k(),w(E,{key:1},{default:s(()=>[e(M,null,{default:s(()=>[e(L,{class:"mt-1"},{default:s(()=>[e(m,{cols:"4"},{default:s(()=>[ae,e(D,{text:"Add an release"},{activator:s(({props:a})=>[e(h,{to:{name:"release-view",params:{releaseId:"new"}}},{default:s(()=>[e($,W({class:"ml-4"},a,{color:"info",icon:"mdi-plus",size:"x-small","data-cy":"add-item"}),null,16)]),_:2},1024)]),_:1})]),_:1}),e(m,{cols:"2",align:"right"},{default:s(()=>[e(T,{modelValue:v(n),"onUpdate:modelValue":l[0]||(l[0]=a=>b(n)?n.value=a:null),label:"Show archived releases",color:"primary","data-cy":"show-archived"},null,8,["modelValue"])]),_:1}),e(m,{cols:"6",align:"right"},{default:s(()=>[e(z,{modelValue:u.value,"onUpdate:modelValue":l[1]||(l[1]=a=>u.value=a),"append-inner-icon":"mdi-magnify",label:"Search",density:"compact",clearable:"","single-line":"","data-cy":"search"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,null,{default:s(()=>[e(j,{class:"elevation-1","sort-by":v(d),"onUpdate:sortBy":l[2]||(l[2]=a=>b(d)?d.value=a:null),headers:V,items:S.value,"items-per-page":v(f),search:u.value,density:"compact","data-cy":"releases-table","onUpdate:itemsPerPage":A},{"item.release_type":s(({item:a})=>[e(h,{to:{name:"release-view",params:{releaseId:a.id}}},{default:s(()=>[X(Y(a.release_type),1)]),_:2},1032,["to"])]),"item.actions":s(({item:a})=>[e(g,{icon:"mdi-pencil",color:"primary",onClick:F=>B(a.id)},null,8,["onClick"]),e(g,{class:"ml-2",icon:"mdi-minus-circle",color:"grey","data-cy":"archive-release",onClick:F=>I(a)},null,8,["onClick"])]),_:1},8,["sort-by","items","items-per-page","search"])]),_:1}),e(ee,{show:r.value,text:"Are you sure you want to archive this release?",onConfirmed:N,onCancelled:l[3]||(l[3]=a=>r.value=!1)},null,8,["show"])]),_:1}))}}});export{ne as default};
